(function(){tinymce.PluginManager.requireLangPack("tablegrid");tinymce.create("tinymce.plugins.TableGrid",{createControl:function(f,a){var d=this,b=d.ed;if(f==="tablegrid"){var e=a.createSplitButton("grid",{title:"tablegrid.create_table",image:d.url+"/img/table-grid.gif",onclick:function(){b.execCommand("mceInsertTable")}});e.showMenu=function(){d.ed.execCommand("openTableGridPopup")};return e}return null},init:function(a,b){var c=this,d=tinymce.DOM;c.url=b;c.ed=a;c.popupIsVisible=0;c.tableGridSelectionBoookmark=null;a.addCommand("openTableGridPopup",function(){c._showPopupMenu()});a.onClick.add(function(f,g){c._hidePopupMenu()});a.onNodeChange.add(function(f,e,h){var g;h=f.selection.getStart();g=f.dom.getParent(h,"td,th,caption");e.setActive("grid",h.nodeName==="TABLE"||!!g);if(g&&g.nodeName==="CAPTION"){g=0}e.setDisabled("delete_table",!g);e.setDisabled("delete_col",!g);e.setDisabled("delete_table",!g);e.setDisabled("delete_row",!g);e.setDisabled("col_after",!g);e.setDisabled("col_before",!g);e.setDisabled("row_after",!g);e.setDisabled("row_before",!g);e.setDisabled("row_props",!g);e.setDisabled("cell_props",!g);e.setDisabled("split_cells",!g);e.setDisabled("merge_cells",!g)});a.onInit.add(function(f,e){d.loadCSS(b+"/css/tablegrid.css");c._createPopupMenu()});d.bind(document,"mousedown",function(g){var h=d.getParent(g.target,".tg-menu-container");var f=g.target.id===a.id+"_grid_open";if(!f&&!h){c._hidePopupMenu()}})},getInfo:function(){return{longname:"Table Grid",author:"Thomas Andersen (thomas@mr-andersen.no)",authorurl:"http://www.mr-andersen.no.com",infourl:"http://www.mr-andersen.no.com",version:"0.1"}},_createPopupMenu:function(){var d=this,a=d.ed,g=a.dom;var f=g.create("div",{id:a.id+"-tg-menu-container","class":"tg-menu-container",style:"display:none"});var c=g.create("div",{id:a.id+"-tg-grid-wrapper","class":"tg-grid-wrapper"});var b=d._createGrid();var e=g.create("div",{id:a.id+"-tg-menu-info","class":"tg-menu-info"},"0 x 0");g.add(f,c);g.add(c,b);g.add(f,e);g.bind(e,"mouseover",function(i){var h=a.getLang("tablegrid.close_grid");i.target.innerHTML=h;i.target.title=h});g.bind(e,"click",function(h){d._hidePopupMenu()});g.add(g.select("body",document)[0],f)},_showPopupMenu:function(h){var j=this,g=j.ed,e=g.dom;var a=e.select("#"+g.id+"-tg-menu-container",document)[0];if(tinymce.isIE){g.focus();j.tableGridSelectionBoookmark=g.selection.getBookmark()}if(j.popupIsVisible){return j._hidePopupMenu()}var b=e.select("#"+g.id+"_grid",document)[0];var f=j.getPos(b);var i=f.top+f.height;var d=f.left;e.addClass(b,"mceSplitButtonSelected");e.show(a);e.setStyles(a,{top:(i+"px"),left:(d+"px")});j.popupIsVisible=1},_hidePopupMenu:function(){var b=this,a=b.ed,e=a.dom;var d=e.select("#"+a.id+"-tg-menu-container",document)[0];var c=e.select("#"+a.id+"_grid",document)[0];if(!d){return}e.removeClass(c,"mceSplitButtonSelected");e.hide(d);b._clearGrid();b.popupIsVisible=0},_createGrid:function(){var m=this,g=m.ed,d=g.dom,h,c,b,f,e;var l=parseInt(g.getParam("tablegrid_row_size"))||10;var k=parseInt(g.getParam("tablegrid_col_size"))||10;var a=d.create("table",{"class":"tg-grid",cellSpacing:1,cellPadding:0});b=d.create("tbody");for(f=0;f<l;f++){h=d.create("tr",{});d.add(b,h);for(e=0;e<k;e++){c=m._createCell(f,e);d.add(h,c)}}d.add(a,b);return a},_createCell:function(g,e){var i=this,d=i.ed,b=d.dom,h,f;var a=b.create("td");var c=b.create("a",{row:g,col:e,"class":"tg-blank"},"&nbsp;");b.add(a,c);b.bind(c,"mouseover",function(j){i._fillCells(j.target)},document);b.bind(c,"click",function(j){h=parseInt(b.getAttrib(j.target,"row"))+1;f=parseInt(b.getAttrib(j.target,"col"))+1;i._insert(h,f);i._hidePopupMenu()},document);return a},_fillCells:function(e){var n=this,h=n.ed,d=h.dom;var b=d.select("#"+h.id+"-tg-menu-container",document)[0];var a=d.select("#"+h.id+"-tg-menu-info",b)[0];var m=d.select("tr",b);var k=parseInt(d.getAttrib(e,"row"))+1,g=parseInt(d.getAttrib(e,"col"))+1;var l,f,c;for(f=0;f<m.length;f++){l=d.select("a",m[f]);for(c=0;c<l.length;c++){if(c<g&&f<k){d.setAttrib(l[c],"class","tg-fill-color");a.innerHTML=(f+1)+" x "+(c+1)}else{d.setAttrib(l[c],"class","tg-blank")}}}},_clearGrid:function(){var c=this,a=c.ed,g=a.dom,b;var d=g.select("#"+a.id+"-tg-menu-container",document)[0];var e=g.select("#"+a.id+"-tg-menu-info",d)[0];var f=g.select("a",d);e.innerHTML="0 x 0";g.setAttrib(f,"class","tg-blank")},_insert:function(a,b){var l=this,h=l.ed,c=h.dom,k=h.selection,e,d;var g='<table border="0" class="mceItemTable" _mce_new="1">\n';g+="<tbody>\n";for(e=0;e<a;e++){g+="<tr>\n";for(d=0;d<b;d++){if(!tinymce.isIE){g+='<td><br _mce_bogus="1" /></td>\n'}else{g+="<td></td>\n"}}g+="</tr>\n"}g+="</tbody>\n";g+="</table>\n";if(tinymce.isIE){h.selection.moveToBookmark(l.tableGridSelectionBoookmark)}h.execCommand("mceBeginUndoLevel");if(h.settings.fix_table_elements){var f="";h.focus();h.selection.setContent('<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(i){if(f){f+=","}f+=i+" ._mce_marker"});tinymce.each(h.dom.select(f),function(i){h.dom.split(h.dom.getParent(i,"h1,h2,h3,h4,h5,h6,p"),i)});c.setOuterHTML(c.select("br._mce_marker")[0],g)}else{h.execCommand("mceInsertContent",false,g)}tinymce.each(c.select("table[_mce_new]"),function(i){var j=c.select("td",i);h.selection.select(j[0],true);h.selection.collapse(true);c.setAttrib(i,"_mce_new","")});h.addVisual();h.execCommand("mceEndUndoLevel")},getPos:function(b){if(b==undefined){return{top:0,left:0,width:0,height:0}}var g=b;var d=g.offsetTop;var a=g.offsetLeft;var c=g.offsetWidth;var f=g.offsetHeight;while(g=g.offsetParent){d+=g.offsetTop;a+=g.offsetLeft}return{top:d,left:a,width:c,height:f}}});tinymce.PluginManager.add("tablegrid",tinymce.plugins.TableGrid)})();